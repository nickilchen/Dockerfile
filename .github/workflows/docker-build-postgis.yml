name: ðŸ³ æž„å»ºå¹¶æŽ¨é€PostGISé•œåƒ

on:
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
    inputs:
      push_to_registry:
        description: 'æŽ¨é€è‡³ä»“åº“'
        required: false
        default: 'true'
        type: boolean
      platforms:
        description: 'ç›®æ ‡å¹³å°'
        required: false
        default: 'linux/amd64,linux/arm64'
        type: string
      tag_suffix:
        description: 'æ ‡ç­¾åŽç¼€ï¼ˆä¾‹å¦‚ï¼š-dev, -betaï¼‰'
        required: false
        default: ''
        type: string

  # æŽ¨é€è§¦å‘ï¼ˆåˆ†æ”¯å’Œæ ‡ç­¾ï¼‰
  push:
    branches:
      - main
      - develop
    tags:
      - 'v*.*.*'
      - 'postgis-*'
    paths:
      # PostGISæ ¸å¿ƒæ–‡ä»¶
      - 'postgis/**/Dockerfile'
      - 'postgis/**/alpine/Dockerfile'
      - 'postgis/**/initdb-postgis.sh'
      - 'postgis/**/update-postgis.sh'
      # æž„å»ºå’Œæµ‹è¯•è„šæœ¬
      - 'postgis/build.sh'
      - 'postgis/test.sh'
      - 'postgis/list-versions.sh'
      - 'postgis/verify-build-system.sh'
      # é…ç½®æ–‡ä»¶
      - 'postgis/docker-compose.yml'
      # å·¥ä½œæµæ–‡ä»¶
      - '.github/workflows/docker-build-postgis.yml'
      # READMEæ–‡æ¡£
      - 'postgis/README.md'

  # Pull Requestæ—¶è§¦å‘ï¼ˆä»…æž„å»ºï¼Œä¸æŽ¨é€ï¼‰
  pull_request:
    branches:
      - main
      - develop
    paths:
      # PostGISæ ¸å¿ƒæ–‡ä»¶
      - 'postgis/**/Dockerfile'
      - 'postgis/**/alpine/Dockerfile'
      - 'postgis/**/initdb-postgis.sh'
      - 'postgis/**/update-postgis.sh'
      # æž„å»ºå’Œæµ‹è¯•è„šæœ¬
      - 'postgis/build.sh'
      - 'postgis/test.sh'
      - 'postgis/list-versions.sh'
      - 'postgis/verify-build-system.sh'
      # é…ç½®æ–‡ä»¶
      - 'postgis/docker-compose.yml'
      # å·¥ä½œæµæ–‡ä»¶
      - '.github/workflows/docker-build-postgis.yml'
      # READMEæ–‡æ¡£
      - 'postgis/README.md'

env:
  # é•œåƒä»“åº“é…ç½®
  REGISTRY: ghcr.io
  ALI_REGISTRY: registry.cn-hangzhou.aliyuncs.com
  IMAGE_NAME: ${{ github.repository }}/postgis
  ALI_IMAGE_NAME: nickilchen/postgis
  
  # é»˜è®¤PostGISé…ç½®
  POSTGIS_VERSION: "3.5"
  POSTGRES_VERSION: "13"

jobs:
  # å‘çŽ°PostGISç‰ˆæœ¬
  discover-versions:
    name: ðŸ” Discover PostGIS Versions
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.discover.outputs.matrix }}
    steps:
      - name: ðŸ“¥ æ£€å‡ºä»£ç ä»“åº“
        uses: actions/checkout@v4

      - name: ðŸ” å‘çŽ°PostGISç‰ˆæœ¬
        id: discover
        run: |
          # æŸ¥æ‰¾æ‰€æœ‰PostGISç‰ˆæœ¬ç›®å½•
          POSTGIS_DIRS=$(find postgis -maxdepth 2 -type d -name "*-*" | sort)
          echo "å‘çŽ°çš„PostGISç›®å½•:"
          echo "$POSTGIS_DIRS"
          
          # æž„å»ºçŸ©é˜µé…ç½®
          MATRIX_JSON="["
          FIRST=true
          
          for dir in $POSTGIS_DIRS; do
            # æ£€æŸ¥æ˜¯å¦å­˜åœ¨alpineç›®å½•
            if [ -d "$dir/alpine" ]; then
              # æå–ç‰ˆæœ¬ä¿¡æ¯
              if [[ $dir =~ postgis/([0-9]+)-([0-9.]+) ]]; then
                PG_VERSION="${BASH_REMATCH[1]}"
                POSTGIS_VERSION="${BASH_REMATCH[2]}"
                
                if [ "$FIRST" = true ]; then
                  FIRST=false
                else
                  MATRIX_JSON="${MATRIX_JSON},"
                fi
                
                MATRIX_JSON="${MATRIX_JSON}{\"pg_version\":\"$PG_VERSION\",\"postgis_version\":\"$POSTGIS_VERSION\",\"path\":\"$dir\"}"
              fi
            fi
          done
          
          MATRIX_JSON="${MATRIX_JSON}]"
          
          echo "çŸ©é˜µé…ç½®: $MATRIX_JSON"
          echo "matrix=$MATRIX_JSON" >> $GITHUB_OUTPUT

  # æž„å»ºé…ç½®åˆ†æž
  build-config:
    name: ðŸ“‹ Build Configuration
    runs-on: ubuntu-latest
    outputs:
      registry: ${{ steps.config.outputs.registry }}
      image-name: ${{ steps.config.outputs.image-name }}
      platforms: ${{ steps.config.outputs.platforms }}
      push-enabled: ${{ steps.config.outputs.push-enabled }}
      cache-key: ${{ steps.config.outputs.cache-key }}
    steps:
      - name: ðŸ” åˆ†æžæž„å»ºé…ç½®
        id: config
        run: |
          # ç¡®å®šæ˜¯å¦æŽ¨é€
          if [[ "${{ github.event_name }}" == "pull_request" ]]; then
            PUSH_ENABLED="false"
          elif [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            PUSH_ENABLED="${{ inputs.push_to_registry }}"
          else
            PUSH_ENABLED="true"
          fi
          
          # ç¡®å®šå¹³å°
          if [[ "${{ github.event_name }}" == "workflow_dispatch" && -n "${{ inputs.platforms }}" ]]; then
            PLATFORMS="${{ inputs.platforms }}"
          else
            PLATFORMS="linux/amd64,linux/arm64"
          fi
          
          # ç”Ÿæˆç¼“å­˜é”®
          CACHE_KEY="postgis-multi-arch-$(echo '$PLATFORMS' | tr ',' '-' | tr '/' '-')"
          
          # è¾“å‡ºé…ç½®
          IMAGE_NAME_LOWER=$(echo "${{ env.IMAGE_NAME }}" | tr '[:upper:]' '[:lower:]')
          echo "registry=${{ env.REGISTRY }}" >> $GITHUB_OUTPUT
          echo "image-name=$IMAGE_NAME_LOWER" >> $GITHUB_OUTPUT
          echo "platforms=$PLATFORMS" >> $GITHUB_OUTPUT
          echo "push-enabled=$PUSH_ENABLED" >> $GITHUB_OUTPUT
          echo "cache-key=$CACHE_KEY" >> $GITHUB_OUTPUT
          
          # æ˜¾ç¤ºé…ç½®
          echo "ðŸ”§ æž„å»ºé…ç½®:"
          echo "  ðŸ“¦ ä»“åº“: ${{ env.REGISTRY }}"
          echo "  ðŸ·ï¸  é•œåƒ: $IMAGE_NAME_LOWER"
          echo "  ðŸ—ï¸  å¹³å°: $PLATFORMS"
          echo "  ðŸ“¤ æŽ¨é€: $PUSH_ENABLED"
          echo "  ðŸ—‚ï¸  ç¼“å­˜é”®: $CACHE_KEY"

  # æž„å»ºå’ŒæŽ¨é€é•œåƒ
  build-and-push:
    name: ðŸ—ï¸ Build and Push PostGIS ${{ matrix.pg_version }}-${{ matrix.postgis_version }}
    runs-on: ubuntu-latest
    needs: [discover-versions, build-config]
    strategy:
      matrix:
        include: ${{ fromJson(needs.discover-versions.outputs.matrix) }}
    permissions:
      contents: read
      packages: write
      
    steps:
      - name: ðŸ“¥ æ£€å‡ºä»£ç ä»“åº“
        uses: actions/checkout@v4

      - name: ðŸ” ç™»å½•å®¹å™¨ä»“åº“
        if: needs.build-config.outputs.push-enabled == 'true'
        uses: docker/login-action@v3
        with:
          registry: ${{ needs.build-config.outputs.registry }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ” ç™»å½•é˜¿é‡Œäº‘å®¹å™¨ä»“åº“
        if: needs.build-config.outputs.push-enabled == 'true'
        uses: docker/login-action@v3
        with:
          registry: ${{ env.ALI_REGISTRY }}
          username: ${{ secrets.ALI_REGISTRY_USERNAME }}
          password: ${{ secrets.ALI_REGISTRY_PASSWORD }}

      - name: ðŸ› ï¸ è®¾ç½®QEMU
        uses: docker/setup-qemu-action@v3
        with:
          platforms: all
          image: tonistiigi/binfmt:latest
          
      - name: ðŸ› ï¸ è®¾ç½®Docker Buildx
        uses: docker/setup-buildx-action@v3
        with:
          driver-opts: |
            network=host
          platforms: ${{ needs.build-config.outputs.platforms }}
          install: true

      - name: ðŸ·ï¸ ç”Ÿæˆæ ‡ç­¾
        id: meta
        run: |
          # ç”Ÿæˆæ ‡ç­¾
          REGISTRY="${{ needs.build-config.outputs.registry }}"
          IMAGE_NAME="${{ needs.build-config.outputs.image-name }}"
          PG_VERSION="${{ matrix.pg_version }}"
          POSTGIS_VERSION="${{ matrix.postgis_version }}"
          TAG_SUFFIX="${{ inputs.tag_suffix || '' }}"
          BRANCH_NAME="${{ github.ref_name }}"
          
          # åŸºæœ¬æ ‡ç­¾
          TAGS=""
          
          # æ ¹æ®äº‹ä»¶ç±»åž‹ç¡®å®šæ ‡ç­¾
          if [[ "${{ github.ref_type }}" == "tag" ]]; then
            # æ ‡ç­¾æŽ¨é€
            if [[ "${{ github.ref_name }}" =~ ^v[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
              VERSION="${{ github.ref_name }}"
              TAGS="${REGISTRY}/${IMAGE_NAME}:${PG_VERSION}-${POSTGIS_VERSION}${TAG_SUFFIX}"
              TAGS="${TAGS},${REGISTRY}/${IMAGE_NAME}:${PG_VERSION}-${POSTGIS_VERSION//./}-${TAG_SUFFIX}"
            else
              TAGS="${REGISTRY}/${IMAGE_NAME}:${{ github.ref_name }}-${PG_VERSION}-${POSTGIS_VERSION}${TAG_SUFFIX}"
            fi
          elif [[ "$BRANCH_NAME" == "main" ]]; then
            # ä¸»åˆ†æ”¯
            TAGS="${REGISTRY}/${IMAGE_NAME}:${PG_VERSION}-${POSTGIS_VERSION}${TAG_SUFFIX}"
            TAGS="${TAGS},${REGISTRY}/${IMAGE_NAME}:${PG_VERSION}-${POSTGIS_VERSION//./}-${TAG_SUFFIX}"
            TAGS="${TAGS},${REGISTRY}/${IMAGE_NAME}:latest${TAG_SUFFIX}"
          elif [[ "$BRANCH_NAME" == "develop" ]]; then
            # å¼€å‘åˆ†æ”¯
            TAGS="${REGISTRY}/${IMAGE_NAME}:${PG_VERSION}-${POSTGIS_VERSION}-dev${TAG_SUFFIX}"
          else
            # å…¶ä»–åˆ†æ”¯æˆ–PR
            SAFE_BRANCH=$(echo "$BRANCH_NAME" | sed 's/[^a-zA-Z0-9.-]/-/g')
            TAGS="${REGISTRY}/${IMAGE_NAME}:${PG_VERSION}-${POSTGIS_VERSION}-${SAFE_BRANCH}${TAG_SUFFIX}"
          fi
          
          # é˜¿é‡Œäº‘æ ‡ç­¾
          ALI_TAGS=""
          if [[ "${{ github.ref_type }}" == "tag" ]]; then
            if [[ "${{ github.ref_name }}" =~ ^v[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
              ALI_TAGS="${{ env.ALI_REGISTRY }}/${{ env.ALI_IMAGE_NAME }}:${PG_VERSION}-${POSTGIS_VERSION}${TAG_SUFFIX}"
              ALI_TAGS="${ALI_TAGS},${{ env.ALI_REGISTRY }}/${{ env.ALI_IMAGE_NAME }}:${PG_VERSION}-${POSTGIS_VERSION//./}-${TAG_SUFFIX}"
            else
              ALI_TAGS="${{ env.ALI_REGISTRY }}/${{ env.ALI_IMAGE_NAME }}:${{ github.ref_name }}-${PG_VERSION}-${POSTGIS_VERSION}${TAG_SUFFIX}"
            fi
          elif [[ "$BRANCH_NAME" == "main" ]]; then
            ALI_TAGS="${{ env.ALI_REGISTRY }}/${{ env.ALI_IMAGE_NAME }}:${PG_VERSION}-${POSTGIS_VERSION}${TAG_SUFFIX}"
            ALI_TAGS="${ALI_TAGS},${{ env.ALI_REGISTRY }}/${{ env.ALI_IMAGE_NAME }}:${PG_VERSION}-${POSTGIS_VERSION//./}-${TAG_SUFFIX}"
            ALI_TAGS="${ALI_TAGS},${{ env.ALI_REGISTRY }}/${{ env.ALI_IMAGE_NAME }}:latest${TAG_SUFFIX}"
          elif [[ "$BRANCH_NAME" == "develop" ]]; then
            ALI_TAGS="${{ env.ALI_REGISTRY }}/${{ env.ALI_IMAGE_NAME }}:${PG_VERSION}-${POSTGIS_VERSION}-dev${TAG_SUFFIX}"
          else
            ALI_TAGS="${{ env.ALI_REGISTRY }}/${{ env.ALI_IMAGE_NAME }}:${PG_VERSION}-${POSTGIS_VERSION}-${SAFE_BRANCH}${TAG_SUFFIX}"
          fi
          
          # åˆå¹¶æ‰€æœ‰æ ‡ç­¾
          ALL_TAGS="$TAGS"
          if [[ -n "$ALI_TAGS" ]]; then
            ALL_TAGS="${ALL_TAGS},${ALI_TAGS}"
          fi
          
          echo "tags=$ALL_TAGS" >> $GITHUB_OUTPUT
          echo "ali-tags=$ALI_TAGS" >> $GITHUB_OUTPUT
          
          echo "ðŸ·ï¸ ç”Ÿæˆçš„æ ‡ç­¾:"
          echo "  GitHub: $TAGS"
          echo "  é˜¿é‡Œäº‘: $ALI_TAGS"

      - name: ðŸ—ï¸ æž„å»ºå¹¶æŽ¨é€Dockeré•œåƒ
        uses: docker/build-push-action@v5
        with:
          context: ./${{ matrix.path }}/alpine
          file: ./${{ matrix.path }}/alpine/Dockerfile
          platforms: ${{ needs.build-config.outputs.platforms }}
          push: ${{ needs.build-config.outputs.push-enabled }}
          tags: ${{ steps.meta.outputs.tags }}
          labels: |
            org.opencontainers.image.title=PostGIS ${{ matrix.postgis_version }} with PostgreSQL ${{ matrix.pg_version }}
            org.opencontainers.image.description=PostGIS ${{ matrix.postgis_version }} spatial database extension with PostgreSQL ${{ matrix.pg_version }} Alpine
            org.opencontainers.image.vendor=PostGIS Project
            postgis.version=${{ matrix.postgis_version }}
            postgres.version=${{ matrix.pg_version }}
            architecture=${{ needs.build-config.outputs.platforms }}
          cache-from: type=gha,scope=${{ needs.build-config.outputs.cache-key }}-${{ matrix.pg_version }}-${{ matrix.postgis_version }}
          cache-to: type=gha,mode=max,scope=${{ needs.build-config.outputs.cache-key }}-${{ matrix.pg_version }}-${{ matrix.postgis_version }}
          build-args: |
            BASE_IMAGE=postgres:${{ matrix.pg_version }}-alpine
            BUILDKIT_INLINE_CACHE=1

      - name: ðŸ“‹ é•œåƒæ‘˜è¦
        if: needs.build-config.outputs.push-enabled == 'true'
        run: |
          echo "ðŸŽ¯ é•œåƒæ‘˜è¦: ${{ steps.meta.outputs.digest }}"
          echo "ðŸ·ï¸ æ ‡ç­¾: ${{ steps.meta.outputs.tags }}"

  # æµ‹è¯•æž„å»ºçš„é•œåƒ
  test-image:
    name: ðŸ§ª Test PostGIS Images
    runs-on: ubuntu-latest
    needs: [discover-versions, build-config, build-and-push]
    if: needs.build-config.outputs.push-enabled == 'true'
    strategy:
      matrix:
        platform: [linux/amd64, linux/arm64]
        include: ${{ fromJson(needs.discover-versions.outputs.matrix) }}
    steps:
      - name: ðŸ“¥ æ£€å‡ºä»£ç ä»“åº“
        uses: actions/checkout@v4

      - name: ðŸ› ï¸ è®¾ç½®Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: ðŸ” ç™»å½•å®¹å™¨ä»“åº“
        uses: docker/login-action@v3
        with:
          registry: ${{ needs.build-config.outputs.registry }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: ðŸ§ª æµ‹è¯•é•œåƒåŠŸèƒ½
        run: |
          # ç”Ÿæˆæµ‹è¯•æ ‡ç­¾
          REGISTRY="${{ needs.build-config.outputs.registry }}"
          IMAGE_NAME="${{ needs.build-config.outputs.image-name }}"
          PG_VERSION="${{ matrix.pg_version }}"
          POSTGIS_VERSION="${{ matrix.postgis_version }}"
          TAG_SUFFIX="${{ inputs.tag_suffix || '' }}"
          PLATFORM="${{ matrix.platform }}"
          
          # æµ‹è¯•æ ‡ç­¾
          TEST_TAG="${REGISTRY}/${IMAGE_NAME}:${PG_VERSION}-${POSTGIS_VERSION}${TAG_SUFFIX}"
          
          echo "ðŸ·ï¸ æµ‹è¯•æ ‡ç­¾: $TEST_TAG"
          echo "ðŸ”§ å¹³å°: $PLATFORM"
          
          # ç¡®ä¿QEMUä»¿çœŸå™¨å¯ç”¨
          docker run --privileged --rm tonistiigi/binfmt:latest --install $PLATFORM
          
          # æ‹‰å–é•œåƒ
          docker pull --platform=$PLATFORM $TEST_TAG
          
          # æµ‹è¯•PostgreSQLå’ŒPostGISåŠŸèƒ½
          echo "ðŸ” æµ‹è¯•PostgreSQLå’ŒPostGISåŠŸèƒ½..."
          docker run --rm --platform=$PLATFORM \
            -e POSTGRES_PASSWORD=testpass \
            -e POSTGRES_USER=testuser \
            -e POSTGRES_DB=testdb \
            $TEST_TAG \
            pg_isready
          
          echo "âœ… å¹³å° $PLATFORM PostgreSQLåŠŸèƒ½æµ‹è¯•é€šè¿‡!"
          
          # æµ‹è¯•PostGISæ‰©å±•
          echo "ðŸ” æµ‹è¯•PostGISæ‰©å±•..."
          docker run --rm --platform=$PLATFORM \
            -e POSTGRES_PASSWORD=testpass \
            -e POSTGRES_USER=testuser \
            -e POSTGRES_DB=testdb \
            $TEST_TAG \
            postgres -c 'SELECT PostGIS_Version();'
          
          echo "âœ… å¹³å° $PLATFORM PostGISæ‰©å±•æµ‹è¯•é€šè¿‡!"

  # å®‰å…¨æ‰«æ
  security-scan:
    name: ðŸ”’ Security Scan
    runs-on: ubuntu-latest
    needs: [discover-versions, build-config, build-and-push]
    if: needs.build-config.outputs.push-enabled == 'true'
    strategy:
      matrix:
        include: ${{ fromJson(needs.discover-versions.outputs.matrix) }}
    permissions:
      security-events: write
      
    steps:
      - name: ðŸ” è¿è¡ŒTrivyæ¼æ´žæ‰«æå™¨
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: ${{ needs.build-config.outputs.registry }}/${{ needs.build-config.outputs.image-name }}:${{ matrix.pg_version }}-${{ matrix.postgis_version }}
          format: 'sarif'
          output: 'trivy-results.sarif'

      - name: ðŸ“¤ ä¸Šä¼ Trivyæ‰«æç»“æžœåˆ°GitHubå®‰å…¨é€‰é¡¹å¡
        uses: github/codeql-action/upload-sarif@v2
        if: always()
        with:
          sarif_file: 'trivy-results.sarif'

  # æž„å»ºæ€»ç»“
  build-summary:
    name: ðŸ“Š Build Summary
    runs-on: ubuntu-latest
    needs: [discover-versions, build-config, build-and-push, test-image]
    if: always()
    
    steps:
      - name: ðŸ“‹ åˆ›å»ºæž„å»ºæ€»ç»“
        run: |
          echo "## ðŸ³ PostGIS Multi-Arch Build Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ“Š Build Information" >> $GITHUB_STEP_SUMMARY
          echo "- **ðŸ·ï¸ Image**: \`${{ needs.build-config.outputs.image-name }}\`" >> $GITHUB_STEP_SUMMARY
          echo "- **ðŸ—ï¸ Platforms**: \`${{ needs.build-config.outputs.platforms }}\`" >> $GITHUB_STEP_SUMMARY
          echo "- **ðŸ“¤ Push**: \`${{ needs.build-config.outputs.push-enabled }}\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # æž„å»ºçŠ¶æ€
          if [[ "${{ needs.build-and-push.result }}" == "success" ]]; then
            echo "### âœ… Build Status: Success" >> $GITHUB_STEP_SUMMARY
          else
            echo "### âŒ Build Status: Failed" >> $GITHUB_STEP_SUMMARY
          fi
          
          # æµ‹è¯•çŠ¶æ€
          if [[ "${{ needs.test-image.result }}" == "success" ]]; then
            echo "### âœ… Test Status: Passed" >> $GITHUB_STEP_SUMMARY
          elif [[ "${{ needs.test-image.result }}" == "skipped" ]]; then
            echo "### â­ï¸ Test Status: Skipped" >> $GITHUB_STEP_SUMMARY
          else
            echo "### âŒ Test Status: Failed" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [[ "${{ needs.build-config.outputs.push-enabled }}" == "true" ]]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ðŸš€ Usage" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`bash" >> $GITHUB_STEP_SUMMARY
            echo "# æ‹‰å–é•œåƒç¤ºä¾‹" >> $GITHUB_STEP_SUMMARY
            echo "docker pull ${{ needs.build-config.outputs.registry }}/${{ needs.build-config.outputs.image-name }}:13-3.5" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "# è¿è¡Œå®¹å™¨ç¤ºä¾‹" >> $GITHUB_STEP_SUMMARY
            echo "docker run -d \\" >> $GITHUB_STEP_SUMMARY
            echo "  --name postgis \\" >> $GITHUB_STEP_SUMMARY
            echo "  -e POSTGRES_PASSWORD=mysecretpassword \\" >> $GITHUB_STEP_SUMMARY
            echo "  -e POSTGRES_USER=myuser \\" >> $GITHUB_STEP_SUMMARY
            echo "  -e POSTGRES_DB=mydb \\" >> $GITHUB_STEP_SUMMARY
            echo "  -p 5432:5432 \\" >> $GITHUB_STEP_SUMMARY
            echo "  ${{ needs.build-config.outputs.registry }}/${{ needs.build-config.outputs.image-name }}:13-3.5" >> $GITHUB_STEP_SUMMARY
            echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          fi