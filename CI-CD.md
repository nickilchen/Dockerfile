# ğŸš€ CI/CD é…ç½®æŒ‡å—

æœ¬é¡¹ç›®ä½¿ç”¨GitHub Actionså®ç°å¤šæ¶æ„Dockeré•œåƒçš„è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚

## ğŸ“‹ å·¥ä½œæµæ¦‚è¿°

### ğŸ³ ä¸»è¦å·¥ä½œæµ

| å·¥ä½œæµæ–‡ä»¶ | è§¦å‘æ¡ä»¶ | åŠŸèƒ½ |
|-----------|----------|------|
| [`docker-build.yml`](.github/workflows/docker-build.yml) | Pushã€PRã€Tagã€æ‰‹åŠ¨è§¦å‘ | å¤šæ¶æ„Dockeré•œåƒæ„å»ºå’Œæ¨é€ |
| [`release.yml`](.github/workflows/release.yml) | å‘å¸ƒã€æ‰‹åŠ¨ç‰ˆæœ¬ç®¡ç† | ç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒæµç¨‹ |
| [`cache-management.yml`](.github/workflows/cache-management.yml) | å®šæ—¶ã€æ‰‹åŠ¨è§¦å‘ | æ„å»ºç¼“å­˜ç®¡ç†å’Œæ€§èƒ½ä¼˜åŒ– |
| [`deployment.yml`](.github/workflows/deployment.yml) | è‡ªåŠ¨éƒ¨ç½²ã€æ‰‹åŠ¨è§¦å‘ | å¤šç¯å¢ƒéƒ¨ç½²æµç¨‹ |

## ğŸ—ï¸ æ„å»ºæµç¨‹

### è‡ªåŠ¨æ„å»ºè§¦å‘æ¡ä»¶

```yaml
# æ¨é€åˆ°ä¸»åˆ†æ”¯
push:
  branches: [main, develop]
  paths: ['gdal/**']

# Pull Request
pull_request:
  branches: [main, develop]
  paths: ['gdal/**']

# æ ‡ç­¾æ¨é€
push:
  tags: ['v*.*.*', 'gdal-*']
```

### æ”¯æŒçš„æ¶æ„

- `linux/amd64` (x86_64)
- `linux/arm64` (aarch64)

### é•œåƒæ ‡ç­¾ç­–ç•¥

| åˆ†æ”¯/æ ‡ç­¾ | ç”Ÿæˆçš„æ ‡ç­¾ | è¯´æ˜ |
|----------|------------|------|
| `main` | `latest`, `stable` | ä¸»åˆ†æ”¯ç¨³å®šç‰ˆ |
| `develop` | `dev`, `nightly` | å¼€å‘åˆ†æ”¯ |
| `v1.2.3` | `1.2.3`, `latest` | ç‰ˆæœ¬æ ‡ç­¾ |
| PR | `pr-123` | Pull Request |

## ğŸ”§ æ‰‹åŠ¨æ„å»º

### åŸºæœ¬æ„å»º

```bash
# åœ¨GitHub Actionsé¡µé¢æ‰‹åŠ¨è§¦å‘ï¼Œæˆ–è€…ï¼š
gh workflow run docker-build.yml
```

### è‡ªå®šä¹‰æ„å»ºå‚æ•°

```bash
# æŒ‡å®šå¹³å°å’Œæ ‡ç­¾
gh workflow run docker-build.yml \
  -f platforms="linux/amd64" \
  -f tag_suffix="-test" \
  -f push_to_registry=false
```

## ğŸ“¦ ç‰ˆæœ¬ç®¡ç†

### è‡ªåŠ¨ç‰ˆæœ¬å‘å¸ƒ

1. **åˆ›å»ºæ ‡ç­¾**ï¼š
   ```bash
   git tag v1.0.0
   git push origin v1.0.0
   ```

2. **è‡ªåŠ¨è§¦å‘**ï¼š
   - æ„å»ºå¤šæ¶æ„é•œåƒ
   - åˆ›å»ºGitHub Release
   - æ¨é€åˆ°é•œåƒä»“åº“

### æ‰‹åŠ¨ç‰ˆæœ¬ç®¡ç†

```bash
# åˆ›å»ºæ–°ç‰ˆæœ¬ï¼ˆè¡¥ä¸ç‰ˆæœ¬ï¼‰
gh workflow run release.yml -f version_type=patch

# åˆ›å»ºé¢„å‘å¸ƒç‰ˆæœ¬
gh workflow run release.yml -f version_type=prerelease -f prerelease=true
```

## ğŸš€ éƒ¨ç½²æµç¨‹

### ç¯å¢ƒé…ç½®

| ç¯å¢ƒ | åˆ†æ”¯ | URL | è¯´æ˜ |
|------|------|-----|------|
| Development | `develop` | https://dev-gdal.example.com | å¼€å‘ç¯å¢ƒ |
| Staging | `main` | https://staging-gdal.example.com | é¢„å‘å¸ƒç¯å¢ƒ |
| Production | å‘å¸ƒæ ‡ç­¾ | https://gdal.example.com | ç”Ÿäº§ç¯å¢ƒ |

### è‡ªåŠ¨éƒ¨ç½²

- **å¼€å‘ç¯å¢ƒ**ï¼š`develop`åˆ†æ”¯æ¨é€æ—¶è‡ªåŠ¨éƒ¨ç½²
- **é¢„å‘å¸ƒç¯å¢ƒ**ï¼š`main`åˆ†æ”¯æ¨é€æ—¶è‡ªåŠ¨éƒ¨ç½²
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šå‘å¸ƒæ–°ç‰ˆæœ¬æ—¶è‡ªåŠ¨éƒ¨ç½²

### æ‰‹åŠ¨éƒ¨ç½²

```bash
# éƒ¨ç½²åˆ°æŒ‡å®šç¯å¢ƒ
gh workflow run deployment.yml \
  -f environment=staging \
  -f image_tag=v1.0.0

# å¼ºåˆ¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
gh workflow run deployment.yml \
  -f environment=production \
  -f image_tag=latest \
  -f force_deploy=true
```

## ğŸ“Š ç¼“å­˜ç®¡ç†

### è‡ªåŠ¨ç¼“å­˜ä¼˜åŒ–

- **ç¼“å­˜é¢„çƒ­**ï¼šæ¯å‘¨æ—¥è‡ªåŠ¨é¢„çƒ­æ„å»ºç¼“å­˜
- **æ™ºèƒ½ç¼“å­˜**ï¼šåŸºäºå¹³å°å’ŒGDALç‰ˆæœ¬çš„åˆ†å±‚ç¼“å­˜

### æ‰‹åŠ¨ç¼“å­˜æ“ä½œ

```bash
# é¢„çƒ­ç¼“å­˜
gh workflow run cache-management.yml -f action=warm-cache

# æ¸…ç†ç¼“å­˜
gh workflow run cache-management.yml -f action=clear-cache

# åˆ†æç¼“å­˜æ€§èƒ½
gh workflow run cache-management.yml -f action=analyze-cache

# æ€§èƒ½åŸºå‡†æµ‹è¯•
gh workflow run cache-management.yml -f action=benchmark-build
```

## ğŸ” å®‰å…¨é…ç½®

### å¿…éœ€çš„Secrets

| Secret | ç”¨é€” | è®¾ç½®æ–¹æ³• |
|--------|------|----------|
| `GITHUB_TOKEN` | GitHub APIè®¿é—® | è‡ªåŠ¨æä¾› |
| å…¶ä»–å¯†é’¥ | æ ¹æ®éƒ¨ç½²éœ€æ±‚ | Repository Settings â†’ Secrets |

### é•œåƒå®‰å…¨

- **è‡ªåŠ¨æ¼æ´æ‰«æ**ï¼šæ¯æ¬¡æ„å»ºæ—¶ä½¿ç”¨Trivyæ‰«æ
- **ç­¾åéªŒè¯**ï¼šç”Ÿäº§éƒ¨ç½²å‰éªŒè¯é•œåƒç­¾å
- **æœ€å°æƒé™**ï¼šä½¿ç”¨érootç”¨æˆ·è¿è¡Œ

## ğŸ“ˆ ç›‘æ§å’ŒæŠ¥å‘Š

### æ„å»ºç›‘æ§

- **æ„å»ºçŠ¶æ€**ï¼šå®æ—¶æ„å»ºçŠ¶æ€æŠ¥å‘Š
- **æ„å»ºæ—¶é—´**ï¼šæ€§èƒ½åŸºå‡†æµ‹è¯•
- **ç¼“å­˜å‘½ä¸­ç‡**ï¼šç¼“å­˜æ•ˆç‡åˆ†æ

### éƒ¨ç½²ç›‘æ§

- **å¥åº·æ£€æŸ¥**ï¼šéƒ¨ç½²åè‡ªåŠ¨å¥åº·æ£€æŸ¥
- **å›æ»šæœºåˆ¶**ï¼šå¤±è´¥æ—¶è‡ªåŠ¨å›æ»š
- **å‘Šè­¦é€šçŸ¥**ï¼šå¼‚å¸¸æƒ…å†µåŠæ—¶é€šçŸ¥

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### æœ¬åœ°æµ‹è¯•æ„å»º

```bash
# ä½¿ç”¨æœ¬åœ°æ„å»ºè„šæœ¬
cd gdal
./build.sh --platforms linux/amd64 --no-push

# ä½¿ç”¨docker-composeæµ‹è¯•
docker-compose up -d
```

### å·¥ä½œæµè°ƒè¯•

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š
   ```bash
   gh run list --workflow=docker-build.yml
   gh run view <run-id> --log
   ```

2. **ä¸‹è½½æ„å»ºäº§ç‰©**ï¼š
   ```bash
   gh run download <run-id>
   ```

### è‡ªå®šä¹‰å·¥ä½œæµ

å¦‚éœ€è‡ªå®šä¹‰å·¥ä½œæµï¼Œå¯ä»¥ï¼š

1. å¤åˆ¶ç°æœ‰å·¥ä½œæµæ–‡ä»¶
2. ä¿®æ”¹è§¦å‘æ¡ä»¶å’Œå‚æ•°
3. è°ƒæ•´æ„å»ºæ­¥éª¤
4. æµ‹è¯•éªŒè¯

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ„å»ºå¤±è´¥**ï¼š
   - æ£€æŸ¥Dockerfileè¯­æ³•
   - éªŒè¯ä¾èµ–å¯ç”¨æ€§
   - æŸ¥çœ‹æ„å»ºæ—¥å¿—

2. **ç¼“å­˜é—®é¢˜**ï¼š
   - æ¸…ç†è¿‡æœŸç¼“å­˜
   - æ£€æŸ¥ç¼“å­˜é”®é…ç½®
   - é‡æ–°é¢„çƒ­ç¼“å­˜

3. **éƒ¨ç½²å¤±è´¥**ï¼š
   - éªŒè¯é•œåƒå­˜åœ¨
   - æ£€æŸ¥ç¯å¢ƒé…ç½®
   - æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—

### è·å–å¸®åŠ©

- æŸ¥çœ‹GitHub Actionsæ—¥å¿—
- æ£€æŸ¥å·¥ä½œæµæ–‡ä»¶é…ç½®
- è”ç³»ç»´æŠ¤å›¢é˜Ÿ

## ğŸ“š æœ€ä½³å®è·µ

### æ„å»ºä¼˜åŒ–

1. **åˆç†ä½¿ç”¨ç¼“å­˜**ï¼šå……åˆ†åˆ©ç”¨GitHub Actionsç¼“å­˜
2. **åˆ†å±‚æ„å»º**ï¼šä¼˜åŒ–Dockerfileå‡å°‘é‡å¤æ„å»º
3. **å¹¶è¡Œæ„å»º**ï¼šå¤šæ¶æ„å¹¶è¡Œæ„å»ºæé«˜æ•ˆç‡

### ç‰ˆæœ¬ç®¡ç†

1. **è¯­ä¹‰åŒ–ç‰ˆæœ¬**ï¼šéµå¾ªSemVerç‰ˆæœ¬è§„èŒƒ
2. **æ¸…æ™°çš„å‘å¸ƒè¯´æ˜**ï¼šè¯¦ç»†æè¿°å˜æ›´å†…å®¹
3. **æµ‹è¯•å……åˆ†**ï¼šå‘å¸ƒå‰å……åˆ†æµ‹è¯•

### éƒ¨ç½²ç­–ç•¥

1. **æ¸è¿›å¼éƒ¨ç½²**ï¼šä»å¼€å‘åˆ°ç”Ÿäº§é€æ­¥éƒ¨ç½²
2. **å¥åº·æ£€æŸ¥**ï¼šéƒ¨ç½²åéªŒè¯åº”ç”¨çŠ¶æ€
3. **å¿«é€Ÿå›æ»š**ï¼šå‡†å¤‡å¥½å›æ»šæ–¹æ¡ˆ

## ğŸ”„ æ›´æ–°å’Œç»´æŠ¤

### å®šæœŸç»´æŠ¤ä»»åŠ¡

- **ä¾èµ–æ›´æ–°**ï¼šå®šæœŸæ›´æ–°åŸºç¡€é•œåƒå’Œä¾èµ–
- **å®‰å…¨æ‰«æ**ï¼šå®šæœŸæ‰§è¡Œå®‰å…¨æ¼æ´æ‰«æ
- **æ€§èƒ½ä¼˜åŒ–**ï¼šç›‘æ§å’Œä¼˜åŒ–æ„å»ºæ€§èƒ½
- **æ–‡æ¡£æ›´æ–°**ï¼šä¿æŒæ–‡æ¡£åŒæ­¥æ›´æ–°

### ç›‘æ§æŒ‡æ ‡

- æ„å»ºæˆåŠŸç‡ > 95%
- å¹³å‡æ„å»ºæ—¶é—´ < 15åˆ†é’Ÿï¼ˆAMD64ï¼‰< 20åˆ†é’Ÿï¼ˆARM64ï¼‰
- ç¼“å­˜å‘½ä¸­ç‡ > 80%
- éƒ¨ç½²æˆåŠŸç‡ > 98%

---

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨CI/CDæµç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹å·¥ä½œæµè¿è¡Œæ—¥å¿—
2. æŸ¥é˜…æœ¬æ–‡æ¡£å’Œç›¸å…³README
3. åœ¨GitHub Issuesä¸­æŠ¥å‘Šé—®é¢˜
4. è”ç³»é¡¹ç›®ç»´æŠ¤å›¢é˜Ÿ